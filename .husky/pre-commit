#!/usr/bin/env sh

echo "üïµÔ∏è Checking code style on all PHP files‚Ä¶"

# Run Rector
echo "‚û°Ô∏è Running Rector..."
vendor/bin/rector process --clear-cache --no-progress-bar
RECTOR_EXIT_CODE=$?

if [ $RECTOR_EXIT_CODE -ne 0 ]; then
    echo "‚ùå Rector failed"
    exit 1
fi

# Run Pint
echo "‚û°Ô∏è Running Pint..."
vendor/bin/pint
PINT_EXIT_CODE=$?

if [ $PINT_EXIT_CODE -ne 0 ]; then
    echo "‚ùå Pint failed"
    exit 1
fi

# Add all modified files to the git working tree
MODIFIED_FILES=$(git diff --name-only -- "*.php")

if [ -n "$MODIFIED_FILES" ]; then
    echo "‚ú® Adding applied changes to the commit‚Ä¶"
    echo "$MODIFIED_FILES" | xargs git add
fi

echo "‚úÖ Code style checks passed!"
exit 0
